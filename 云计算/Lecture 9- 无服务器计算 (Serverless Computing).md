## 1. 无服务器计算简介 (Introduction to Serverless Computing)

无服务器计算 (Serverless Computing) 并不是真的"没有服务器"，而是指**开发者不需要关心底层服务器的管理和维护**。这种云计算模式下，开发者只需专注于编写和部署函数代码，而不必考虑服务器的配置、扩展和维护等基础设施问题。

简单来说：

- 传统方式：你需要购买/租用服务器，并负责其配置、维护、扩容等
- 无服务器方式：你只需编写功能代码，上传到云平台，其余由平台自动管理

### 1.1 背景与动机 (Background and Motivation)

- 传统的基础设施即服务 (Infrastructure-as-a-Service, IaaS) 部署模式需要长期运行的服务器
- 这种专用资源分配需要保持资源，无论用户应用程序是否正在运行
- 结果导致数据中心资源利用率低，平均仅约10%，特别是对于具有日变化模式的在线服务
- 这一矛盾推动了**平台管理的按需服务模型**的发展，以实现更高的资源利用率和更低的云计算成本
- 为此，提出了无服务器计算，目前大多数大型云供应商如Amazon、Google、Microsoft、IBM和Alibaba都已提供此类弹性计算服务

### 1.2 无服务器计算定义 (Definition)

- **Serverless Computing = FaaS (Function-as-a-Service) + BaaS (Backend-as-a-Service)**
    
    ![[截屏2025-04-10_14.44.27.png]]
    
- 无服务器计算将计算单元的粒度减小到函数级别
- 从开发者角度来看，它促进了管理的轻量化和简化
- 无服务器计算可以被视为**函数即服务 (FaaS)**
- 开发者只需用高级语言(如Java、Python)编写云函数，设置简单参数，并上传到无服务器平台
- 无服务器平台还为客户部署依赖于应用程序的服务，也称为**后端即服务 (BaaS)**，如数据库和对象存储服务(OSS)

## 2. 计算虚拟化的演变 (Evolution of Computation Virtualization)

### 2.1 三个发展阶段

计算虚拟化的演变大致经历了三个阶段:

1. **虚拟机 (Virtual Machine, VM)**:
    - 特点：多个操作系统在一台主机上运行
    - 优势：更高的隔离性和更好的硬件资源利用率
    - 缺点：内存开销高，影响整体系统性能
2. **容器 (Container)**:
    - 代表技术：Docker
    - 优势：利用共享内核增加部署速度和可移植性，同时降低成本
    - 特点：减小了虚拟化单元的大小和资源占用
3. **无服务器 (Serverless)**:
    - 首个实现：2015年亚马逊的AWS Lambda
    - 工作方式：无服务器平台作为应用和底层基础设施之间的交互媒介
    - 特点：简化应用开发，对开发者隐藏资源管理

### 2.2 无服务器架构的价值

- 云计算降低了大多数普通用户的成本并提高了资源利用率
- 然而云用户在与云交互时仍承担沉重负担，因此无法充分享受云提供的好处
- 无服务器平台让用户无法观察到服务器，尽管无服务器平台仍依赖服务器设置基本运行环境

## 3. 无服务器计算的组成与工作流程 (Components and Workflow)

### 3.1 FaaS模型组成

在FaaS模型(又称Lambda范式)中:

- 应用程序被切分为**函数**或函数级微服务
- 函数标识符、语言运行时、一个实例的内存限制和函数代码blob URI共同定义了函数的存在

### 3.2 BaaS服务范围

BaaS涵盖应用程序所依赖的广泛服务:

- 云存储 (如Amazon S3和DynamoDB)
- 消息总线系统 (如Google Cloud pub/sub)
- 消息通知服务 (如Amazon SNS)
- DevOps工具 (如Microsoft Azure DevOps)

### 3.3 函数调用流程 (Function Invocation Flow)

无服务器系统的调用分为两种:

**异步调用示例**:

1. 事件触发控制器
2. 控制器通过创建新沙箱(冷启动)或重用运行中的沙箱(热启动)调用函数
3. 隔离确保每个函数调用在单独的容器或虚拟机中运行
4. 执行结果保存在存储中

**调用场景示例**:

1. 客户端调用函数F1，该函数从数据库检索数据
2. 执行一些操作并将结果发送回客户端
3. 客户端也可以调用F2，然后F2调用另一个函数F3
4. 结果发送回F2，然后F2将结果发送给客户端

## 4. 无服务器计算的特性 (Characteristics)

### 4.1 自动扩展 (Auto-scaling)

- 无服务器系统识别的不可或缺因素是在适应工作负载动态变化时执行**水平和垂直扩展**
- 允许应用程序实例数量扩展到零带来的挑战 - **冷启动**
- 冷启动时，实例需要从头开始，初始化软件环境，加载特定应用程序代码，显著拖慢服务响应

### 4.2 灵活调度 (Flexible Scheduling)

- 应用程序不再绑定到特定服务器，无服务器控制器根据集群中的资源使用情况动态调度应用程序
- 支持**多区域协作**考虑，以实现更强大和可用的无服务器系统
- 无主机和弹性：用户不需要自己处理服务器，减少了操作开销

### 4.3 事件驱动 (Event-driven)

- 无服务器应用程序由**事件触发**，如RESTful HTTP查询的到达、消息队列的更新或存储服务的新数据
- 通过触发器和规则将事件绑定到函数，控制器和函数可以使用上下文属性中封装的元数据
- 云原生计算基金会(CNCF)无服务器组发布了CloudEvents规范，用于常见描述事件元数据以提供互操作性

### 4.4 透明开发 (Transparent Development)

- 管理底层主机资源不再困扰应用程序维护人员，因为他们对执行环境一无所知
- 云供应商应确保**隔离沙箱**、可靠的执行环境、可用的物理节点、软件运行时和计算能力
- 无服务器计算还应集成DevOps工具，帮助更高效地部署和迭代

### 4.5 按使用付费 (Pay-as-you-go)

- 无服务器计费模型将计算能力成本从资本支出转变为运营支出
- 此模型消除了用户根据峰值负载购买专用服务器的要求
- 通过共享网络、磁盘、CPU、内存和其他资源，按使用付费模型仅指示应用程序实际使用的资源

### 4.6 函数服务流程 (Function Serving Process)

1. **编程阶段**:
    - 程序员编写代码
    - 将函数部署到平台
    - 平台将函数保存在数据库中
    - 将函数运行时推送到存储库
    - 返回函数URL给程序员
2. **函数服务阶段**:
    - 用户通过API网关使用URL或配置的触发事件调用函数
    - 平台的负载均衡器或调度器从数据库获取函数
    - 准备运行环境(沙箱)
    - 从远程存储库获取函数的运行时
    - 初始化特定于应用程序的环境
    - 执行函数

### 4.7 无状态性 (Statelessness)

- 有状态应用程序可以记住每次运行时的状态，需要持久存储来存储状态
- 无服务器函数通常在无服务器平台托管的**无状态容器**中运行，仅短暂存在，不在持久存储中保存临时状态信息
- 这种方式使平台的横向扩展相对容易，用户只需启动更多实例

### 4.8 短暂但可变的执行时间 (Short but Variable Execution Times)

- 无服务器中的函数通常存活在几百毫秒到几分钟的范围内，计费单位精确到毫秒级
- AWS Lambda特别将其函数执行限制为15分钟，并以100ms为单位向用户计费

### 4.9 函数内并行性差 (Poor Intra-Function Parallelism)

- 函数间并行化模式是通过一组单独的函数实例并行化应用程序，并通过持久存储共享数据
- 这种模式可能导致并发函数实例之间显著的**通信和同步开销**
- 在单个函数实例内并行化函数并执行可能更适合且更经济，特别是对于计算密集型工作负载

### 4.10 迁移挑战 (Migration Challenges)

- 在无服务器平台中，源代码、二进制文件和其他依赖项需要远程获取
- 每个函数调用还需要初始化隔离执行环境(如docker)
- 因此，无服务器函数往往有启动成本，使迁移不那么吸引人
- 结果，在无服务器平台的自动扩展和负载均衡期间，系统开销和服务延迟可能增加

### 4.11 突发性 (Burstiness)

- 工作负载通常在几秒钟内波动其并行度，幅度可达几个数量级
- 当工作负载包含突然和意外的强度变化或负载峰值时，就会出现突发性
- 研究人员测试了一组在无服务器平台上的工作负载，发现81%的测试工作负载具有突发性
- 这表明突发性是无服务器计算中一个常见且重要的特性，与云计算不同

## 5. 无服务器计算的应用 (Applications)

### 5.1 实时协作与分析 (Real-time Collaboration and Analytics)

- 无服务器服务的无状态特性使其成为实时协作工具的理想平台，如即时消息和聊天机器人
- 实时跟踪是另一个适合无服务器服务的协作工具示例
- 无服务器服务还用于数据分析应用，各种来源的实时数据流传输到无服务器服务
- 无服务器计算的自动扩展功能使处理并发大规模数据流成为可能

### 5.2 城市和工业管理系统 (Urban and Industrial Management Systems)

无服务器服务的按使用付费模型为各种预算受限的城市和工业管理系统的引入和实施铺平了道路:

- 城市智能废物管理系统
- 油气田管理系统
- 用于土地估价的无服务器GIS平台
- 智能电网
- 城市灾难恢复应用
- 使用无服务器服务的灾后社区形成方法

### 5.3 科学计算 (Scientific Computing)

使用无服务器计算进行科学计算的一些例子:

- 用于线性代数问题的无服务器工具
- 矩阵乘法
- 大规模优化
- 科学工作流
- DNA和RNA计算

### 5.4 视频处理和流媒体 (Video Processing and Streaming)

- 无服务器用于视频处理：Sprocket是一个无服务器视频处理框架，利用视频内并行性实现低延迟和低成本
- 其他例子包括：
    - 无服务器环境中的实时媒体流
    - 无服务器人脸口罩检测方法
    - 视频监控应用

### 5.5 系统和软件安全 (System and Software Security)

无服务器方法在安全性方面具有巨大潜力:

1. 安全威胁通常是特定的：按使用付费定价可降低成本
2. 一些攻击表现出突然的流量爆发：无服务器服务的自动扩展功能便于处理此类场景
3. 攻击者可能进行广泛攻击：无服务器函数是独立的，可以在各种执行环境中执行

### 5.6 物联网 (IoT)

- 无服务器服务可以作为具有不频繁和零星请求的IoT应用程序的可行后端
- 对于出现不可预测的请求突增的场景，无服务器服务可以方便地处理请求，因为它们可以快速自动扩展

### 5.7 电子商务、银行和加密货币

- 无服务器服务固有的可扩展性吸引了一些电子商务和银行应用

## 6. 总结 (Summary)

### 6.1 无服务器计算的价值

- 降低管理服务器的负担
- 自动扩展以适应变化的需求
- 按使用付费的价格模型
- 事件驱动的流处理

### 6.2 无服务器计算的挑战

- 冷启动导致的延迟问题
- 状态管理的复杂性
- 函数间通信开销
- 迁移的困难

### 6.3 关键概念

- **FaaS (Function-as-a-Service)**: 无服务器计算的核心组件，处理函数执行
- **BaaS (Backend-as-a-Service)**: 提供必要的后端资源，如数据库和存储
- **冷启动 (Cold Startup)**: 从头开始创建新沙箱的过程
- **热启动 (Warm Startup)**: 重用现有运行环境的过程
- **按使用付费 (Pay-as-you-go)**: 只为实际使用的资源付费的计费模型
- **事件驱动 (Event-driven)**: 由外部事件触发计算的模式

无服务器计算代表了云资源管理的创新飞跃，通过简化开发过程并提高资源利用率，为云计算带来了新的可能性。